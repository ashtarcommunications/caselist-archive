var XWiki=(function(a){a.Activity=Class.create({initialize:function(){this.initHandlers();this.attachDeleteHandlers()},initHandlers:function(){$$(".activityHeader").each(function(b){if(b.up().hasClassName("collapsed")){b.observe("click",this.toggle.bind(this,b.up()))}}.bind(this));document.observe("xwiki:activity:newActivity",function(b){$$(".activity").each(this.updateActivity.bind(this))}.bind(this))},toggle:function(){var b=arguments[0];if(b.hasClassName("collapsed")){b.removeClassName("collapsed");b.down(".toolExpand").update("&#9650;")}else{b.addClassName("collapsed");b.down(".toolExpand").update("&#9660;")}},updateActivity:function(c){var b=c.down(".updateURL").value;new Ajax.Updater({success:c},b,{onCreate:function(){},onSuccess:function(){if(c&&c._notification){c._notification.hide()}},onFailure:function(d){var e="";if(d.statusText==""||d.status==12031){e="Server not responding"}else{e=d.statusText}if(c){if(c._notification){c._notification.hide()}c._notification=new a.widgets.Notification("Failed: "+e,"error")}},on1223:function(d){d.request.options.onSuccess(d)},on0:function(d){d.request.options.onFailure(d)},onComplete:function(e){if(e.request.success()){var d=c.next();if(d){d.down(".updateURL").value=b}c.remove();this.attachDeleteHandlers()}}.bind(this),insertion:"after"})},attachDeleteHandlers:function(){$$(".activity .activityItem .toolDelete").invoke("observe","click",function(c){c.stop();var b=c.element();b.blur();if(b.disabled){return}else{new a.widgets.ConfirmedAjaxRequest(b.href.replace(/xredirect=.*$/,"xpage=plain&confirm=1"),{onCreate:function(){b.disabled=true},onSuccess:function(){b.up("li").remove()},onComplete:function(){b.disabled=false}},{confirmationText:"Are you sure you wish to delete this message?"})}})}});return a}(XWiki||{}));document.observe("xwiki:dom:loaded",function(){new XWiki.Activity()});